 ! BEGIN
! Command: "show current-config message-vpn default"
! Generated by:
!   Username: "admin"
!   Date: "2017-06-16T05:11:23.475Z"
!   Version: "8.3.0.1004"
!   dbVersion: "119"
!   Unlocked Features:
!   Appliance: "solvmr830"

! pragma:interpreter:relaxed-db-restore

home
enable
configure

! Create Message Vpn: "default"
message-vpn "default"
  authentication
    user-class "client"
      basic auth-type none
      no basic radius-domain
      no basic shutdown
      client-certificate validate-certificate-date
      no client-certificate allow-api-provided-username
      client-certificate max-certificate-chain-depth 3
      client-certificate shutdown
      exit
    exit
  authorization
    user-class "client"
      ldap group-membership-attribute-name "memberOf"
      authorization-type internal
      exit
    exit
  bridging ssl server-certificate-validation enforce-trusted-common-name
  bridging ssl server-certificate-validation max-certificate-chain-depth 3
  bridging ssl server-certificate-validation validate-certificate-date
  distributed-cache-management
  no export-policy export-subscriptions
  max-connections 1000
  max-subscriptions 500000
  no semp-over-msgbus shutdown
  no semp-over-msgbus show-cmds shutdown
  no semp-over-msgbus admin-cmds shutdown
  no semp-over-msgbus admin-cmds distributed-cache-cmds shutdown
  no semp-over-msgbus admin-cmds client-cmds shutdown
  service smf max-connections 1000
  no service smf plain-text shutdown
  no service smf ssl shutdown
  service web-transport max-connections 1000
  no service web-transport plain-text shutdown
  no service web-transport ssl shutdown
  service rest incoming max-connections 1000
  service rest incoming listen-port 9000
  no service rest incoming plain-text shutdown
  service rest incoming listen-port 9443 ssl
  no service rest incoming ssl shutdown
  service rest outgoing max-connections 1000
  service mqtt max-connections 1000
  service mqtt listen-port 1883
  no service mqtt plain-text shutdown
  service mqtt listen-port 8883 ssl
  no service mqtt ssl shutdown
  service mqtt listen-port 8000 web
  no service mqtt websocket shutdown
  service mqtt listen-port 8443 ssl web
  no service mqtt websocket-secure shutdown
  event connections thresholds set-percentage 80 clear-percentage 60
  event service smf connections thresholds set-percentage 80 clear-percentage 60
  event service web-transport connections thresholds set-percentage 80 clear-percentage 60
  event service rest incoming connections thresholds set-percentage 80 clear-percentage 60
  event service mqtt connections thresholds set-percentage 80 clear-percentage 60
  event egress-message-rate thresholds set-value 4000000 clear-value 3000000
  event ingress-message-rate thresholds set-value 4000000 clear-value 3000000
  event large-message-threshold 1024
  no event log-tag
  no event publish-client
  no event publish-message-vpn
  event publish-topic-format smf
  no event publish-subscription
  event subscriptions thresholds set-percentage 80 clear-percentage 60
  replication
    ack-propagation interval messages 20
    no ack-propagation shutdown
    transaction-replication-mode "async"
    bridge authentication auth-scheme "Basic"
    no bridge authentication basic client-username
    no bridge compressed-data
    no bridge ssl
    bridge message-spool window-size 255
    bridge retry-delay 3
    bridge unidirectional client-profile "#client-profile"
    queue max-spool-usage 1500
    queue reject-msg-to-sender-on-discard
    exit
  rest
    create rest-delivery-point "blue"
      client-profile "default"
      create queue-binding "AA"
        post-request-target "/"
        exit
      create queue-binding "FY"
        post-request-target "/"
        exit
      create rest-consumer "scale_a_blue"
        authentication auth-scheme "none"
        no authentication http-basic username
        no local interface
        remote host "192.168.56.1"
        remote max-post-wait-time 30
        remote outgoing-connection-count 3
        remote port 1981
        remote retry delay 3
        shutdown
        exit
      create rest-consumer "scale_b_blue"
        authentication auth-scheme "none"
        no authentication http-basic username
        no local interface
        remote host "192.168.56.1"
        remote max-post-wait-time 30
        remote outgoing-connection-count 3
        remote port 1982
        remote retry delay 3
        shutdown
        exit
      no shutdown
      exit
    create rest-delivery-point "green"
      client-profile "default"
      create rest-consumer "scale_a_green"
        authentication auth-scheme "none"
        no authentication http-basic username
        no local interface
        remote host "192.168.56.1"
        remote max-post-wait-time 30
        remote outgoing-connection-count 3
        remote port 1981
        remote retry delay 3
        no shutdown
        exit
      create rest-consumer "scale_b_green"
        authentication auth-scheme "none"
        no authentication http-basic username
        no local interface
        remote host "192.168.56.1"
        remote max-post-wait-time 30
        remote outgoing-connection-count 3
        remote port 1982
        remote retry delay 3
        no shutdown
        exit
      no shutdown
      exit
    exit
  ssl
    no allow-downgrade-to-plain-text
    exit
  exit

! Create Message Spool: "default"
message-spool message-vpn "default"
  max-spool-usage 1500
  max-transacted-sessions 1000
  max-transactions 5000
  max-endpoints 1000
  max-egress-flows 1000
  max-ingress-flows 1000
  event spool-usage thresholds set-percentage 80 clear-percentage 60
  event transacted-sessions thresholds set-percentage 80 clear-percentage 60
  event transactions thresholds set-percentage 80 clear-percentage 60
  event endpoints thresholds set-percentage 80 clear-percentage 60
  event egress-flows thresholds set-percentage 80 clear-percentage 60
  event ingress-flows thresholds set-percentage 80 clear-percentage 60
  create queue "AA"
    access-type "exclusive"
    max-bind-count 1000
    max-delivered-unacked-msgs-per-flow 10000
    max-message-size 10000000
    max-spool-usage 1500
    max-redelivery 0
    reject-msg-to-sender-on-discard
    reject-low-priority-msg-limit 0
    event bind-count thresholds set-percentage 80 clear-percentage 60
    event reject-low-priority-msg-limit thresholds set-percentage 80 clear-percentage 60
    event spool-usage thresholds set-percentage 80 clear-percentage 60
    no owner
    permission all consume
    no respect-ttl
    no max-ttl
    no reject-low-priority-msg
    subscription topic "scale/*/*/*/AA" 
    subscription topic "scale/*/*/*/AA/>" 
    subscription topic "scale/*/*/*/AA/BB" 
    no shutdown ingress
    no shutdown egress
    exit
  create queue "BB"
    access-type "exclusive"
    max-bind-count 1000
    max-delivered-unacked-msgs-per-flow 10000
    max-message-size 10000000
    max-spool-usage 1500
    max-redelivery 0
    reject-msg-to-sender-on-discard
    reject-low-priority-msg-limit 0
    event bind-count thresholds set-percentage 80 clear-percentage 60
    event reject-low-priority-msg-limit thresholds set-percentage 80 clear-percentage 60
    event spool-usage thresholds set-percentage 80 clear-percentage 60
    no owner
    permission all consume
    no respect-ttl
    no max-ttl
    no reject-low-priority-msg
    subscription topic "scale/*/*/*/BB" 
    subscription topic "scale/*/*/*/BB/>" 
    no shutdown ingress
    no shutdown egress
    exit
  create queue "FY"
    access-type "exclusive"
    max-bind-count 1000
    max-delivered-unacked-msgs-per-flow 10000
    max-message-size 10000000
    max-spool-usage 1500
    max-redelivery 0
    reject-msg-to-sender-on-discard
    reject-low-priority-msg-limit 0
    event bind-count thresholds set-percentage 80 clear-percentage 60
    event reject-low-priority-msg-limit thresholds set-percentage 80 clear-percentage 60
    event spool-usage thresholds set-percentage 80 clear-percentage 60
    no owner
    permission all consume
    respect-ttl
    max-ttl 60
    no reject-low-priority-msg
    subscription topic "scale/*/*/*/FY/>" 
    no shutdown ingress
    no shutdown egress
    exit
  exit

! Create MQTT Sessions: 
message-vpn "default"
  mqtt
    exit
  exit

! Create Client Profile: "default"
client-profile "default" message-vpn "default"
  allow-bridge-connections
  service smf max-connections-per-client-username 1000
  service web-transport inactive-timeout 30
  service web-transport max-web-payload 1000000
  service web-transport max-connections-per-client-username 1000
  max-connections-per-client-username 1000
  max-subscriptions 500000
  message-spool allow-guaranteed-endpoint-create
  message-spool allow-guaranteed-message-receive
  message-spool allow-guaranteed-message-send
  message-spool allow-transacted-sessions
  message-spool allow-cut-through-forwarding
  message-spool max-transacted-sessions 10
  message-spool max-transactions 5000
  message-spool max-endpoints-per-client-username 1000
  message-spool max-egress-flows 1000
  message-spool max-ingress-flows 1000
  no message-spool api-queue-management copy-from-on-create
  no message-spool api-topic-endpoint-management copy-from-on-create
  queue "G-1"
    max-depth 20000
    min-msg-burst 255
    exit
  queue "D-1"
    max-depth 20000
    min-msg-burst 4
    exit
  queue "D-2"
    max-depth 20000
    min-msg-burst 4
    exit
  queue "D-3"
    max-depth 20000
    min-msg-burst 4
    exit
  queue "C-1"
    max-depth 20000
    min-msg-burst 4
    exit
  tcp initial-cwnd 2
  tcp keepalive count 5
  tcp keepalive idle 3
  tcp keepalive interval 1
  tcp max-wnd 256
  tcp mss 1460
  event connections-per-client-username thresholds set-percentage 80 clear-percentage 60
  event service smf connections-per-client-username thresholds set-percentage 80 clear-percentage 60
  event service web-transport connections-per-client-username thresholds set-percentage 80 clear-percentage 60
  event subscriptions thresholds set-percentage 80 clear-percentage 60
  event client-provisioned-endpoint-spool-usage thresholds set-percentage 80 clear-percentage 60
  event transacted-sessions thresholds set-percentage 80 clear-percentage 60
  event transactions thresholds set-percentage 80 clear-percentage 60
  event endpoints-per-client-username thresholds set-percentage 80 clear-percentage 60
  event egress-flows thresholds set-percentage 80 clear-percentage 60
  event ingress-flows thresholds set-percentage 80 clear-percentage 60
  no replication allow-clients-when-standby
  exit

! Create ACL Profile: "default"
acl-profile "default" message-vpn "default"
  client-connect default-action "allow"
  publish-topic default-action "allow"
  subscribe-topic default-action "allow"
  exit

! Create Client Username: "default"
client-username "default" message-vpn "default"
  acl-profile "default"
  client-profile "default"
  no guaranteed-endpoint-permission-override
  aes-password "ksZ37RJJZqiwWftkJqgdUUTkBE6zMP+arO0EyCnpg+tsORn6nDl73fZbvVIgsNC5"
  no subscription-manager
  no shutdown
  exit

! Create JNDI: "default"
jndi message-vpn "default"
! pragma:interpreter:ignore-already-exists
  create connection-factory "/jms/cf/default"
    property-list "messaging-properties"
      property "default-delivery-mode" "persistent"
      property "text-msg-xml-payload" "true"
      property "default-dmq-eligible" "false"
      property "default-eliding-eligible" "false"
      property "xa" "true"
      property "jmsx-user-id-enabled" "false"
      exit
    property-list "transport-properties"
      property "connect-timeout" "30000"
      property "read-timeout" "10000"
      property "reconnect-retries" "3"
      property "reconnect-retry-wait" "3000"
      property "keep-alive-enabled" "true"
      property "keep-alive-interval" "3000"
      property "keep-alive-count-max" "3"
      property "send-buffer" "65536"
      property "receive-buffer" "65536"
      property "tcp-no-delay" "true"
      property "direct-transport" "false"
      property "compression-level" "-1"
      property "port" "-1"
      property "optimize-direct" "false"
      property "msg-callback-on-io-thread" "false"
      property "connect-retries-per-host" "0"
      property "connect-retries" "0"
      exit
    property-list "ad-properties"
      property "send-ad-window-size" "255"
      property "send-ack-timer" "2000"
      property "send-max-resends" "30"
      property "receive-ad-window-size" "18"
      property "receive-ack-timer" "1000"
      property "receive-ack-threshold" "60"
      exit
    property-list "deliver-to-one-properties"
      property "subscriber-local-priority" "1"
      property "subscriber-network-priority" "1"
      property "deliver-to-one" "false"
      property "deliver-to-one-override" "true"
      exit
    property-list "dynamic-endpoint-properties"
      property "dynamic-durables" "false"
      property "respect-ttl" "true"
      exit
    property-list "client-properties"
      no property client-id
      no property client-description
      exit
    exit
! pragma:interpreter:no-ignore-already-exists
  no shutdown
  exit

! Enable Message Vpn: "default"
message-vpn "default"
  no shutdown
  replication
    state "standby"
    shutdown
    exit
  exit

! Configure Management Message Vpn: 
no management-message-vpn

! END
